import{useState as s,useEffect as k,createRoot as y}from"@wordpress/element";import w from"@wordpress/api-fetch";import{__ as t}from"@wordpress/i18n";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))d(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const p of r.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&d(p)}).observe(document,{childList:!0,subtree:!0});function i(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(e){if(e.ep)return;e.ep=!0;const r=i(e);fetch(e.href,r)}})();const _=({onTicketCreated:n})=>{const[o,i]=s(!1),[d,e]=s(!1),[r,p]=s(null),h={title:"",content:"",status:"publish",meta:{tickefic_priority:"normal",tickefic_status:"open"},tickefic_cat:[37]},[m,c]=s(h),f=g=>{const{name:u,value:v}=g.target;if(u.startsWith("meta.")){const E=u.split(".")[1];c(b=>({...b,meta:{...b.meta,[E]:v}}))}else c(u==="tickefic_cat"?E=>({...E,[u]:[parseInt(v)]}):E=>({...E,[u]:v}))},x=async g=>{g.preventDefault(),e(!0),p(null);try{const u=await w({path:"http://localhost/devspark/wordpress-backend/wp-json/wp/v2/tickefic/",method:"POST",data:m,headers:{"X-WP-Nonce":SupportDashboard.nonce}});c(h),i(!1),n&&n(u)}catch(u){p(u.message||t("Failed to create ticket","tickefic"))}finally{e(!1)}};return React.createElement("div",{className:"max-w-2xl mb-8"},o?React.createElement("div",{className:"bg-white rounded-xl shadow-xl border border-slate-200 overflow-hidden"},React.createElement("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50"},React.createElement("h3",{className:"font-bold text-slate-800"},t("Create Ticket","tickefic")),React.createElement("button",{onClick:()=>i(!1),className:"text-slate-400 hover:text-red-500"},"✕")),React.createElement("form",{onSubmit:x,className:"p-6"},React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1"},t("Subject","tickefic")),React.createElement("input",{type:"text",name:"title",value:m.title,onChange:f,required:!0,className:"w-full px-3 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500"})),React.createElement("div",{className:"grid grid-cols-2 gap-4 mb-4"},React.createElement("div",null,React.createElement("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1"},t("Priority","tickefic")),React.createElement("select",{name:"meta.tickefic_priority",value:m.meta.tickefic_priority,onChange:f,className:"w-full px-3 py-2 border rounded-lg outline-none"},React.createElement("option",{value:"low"},t("Low","tickefic")),React.createElement("option",{value:"normal"},t("Normal","tickefic")),React.createElement("option",{value:"high"},t("High","tickefic")))),React.createElement("div",null,React.createElement("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1"},t("Category","tickefic")),React.createElement("select",{name:"tickefic_cat",value:m.tickefic_cat[0],onChange:f,className:"w-full px-3 py-2 border rounded-lg outline-none"},React.createElement("option",{value:"38"},t("Technical Issue","tickefic")),React.createElement("option",{value:"37"},t("Billing / Account","tickefic")),React.createElement("option",{value:"39"},t("Feature Request","tickefic"))))),React.createElement("div",{className:"mb-6"},React.createElement("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1"},t("Message","tickefic")),React.createElement("textarea",{name:"content",value:m.content,onChange:f,required:!0,rows:"4",className:"w-full px-3 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500"})),r&&React.createElement("div",{className:"mb-4 p-3 bg-red-50 text-red-600 text-xs rounded border border-red-100"},r),React.createElement("button",{type:"submit",disabled:d,className:"w-full bg-slate-900 hover:bg-blue-600 disabled:bg-slate-400 text-white font-bold py-2.5 rounded-lg transition-colors"},d?t("Sending...","tickefic"):t("Submit Ticket","tickefic")))):React.createElement("button",{onClick:()=>i(!0),className:"w-[300px] py-2 rounded-xl flex items-center justify-center gap-2 text-slate-600 border border-slate-200 hover:border-blue-400 hover:bg-blue-50 transition-all group"},React.createElement("span",{className:"text-xl group-hover:rotate-90 transition-transform"},"＋"),React.createElement("span",{className:"font-semibold"},t("Open a New Support Ticket","tickefic"))))};function T({tickets:n,loading:o,currentPage:i,totalPages:d,onPageChange:e,activeTab:r,setActiveTab:p}){const[h,m]=s(null),[c,f]=s([]),[x,g]=s(""),[u,v]=s(!1),E=a=>{const l=document.createElement("textarea");return l.innerHTML=a,l.value.replace(/<[^>]*>/g,"")};k(()=>{h&&(f([]),w({path:`http://localhost/devspark/wordpress-backend/wp-json/wp/v2/comments?post=${h}&order=asc&_embed`}).then(a=>f(a)).catch(a=>console.error("Error fetching replies:",a)))},[h]);const b=a=>{x.trim()&&(v(!0),w({path:"http://localhost/devspark/wordpress-backend/wp-json/wp/v2/comments",method:"POST",data:{post:a,content:x,status:"approve"},headers:{"X-WP-Nonce":window.SupportDashboard?.nonce}}).then(l=>{f([...c,l]),g("")}).catch(l=>alert(l.message||t("Failed to send reply.","tickefic"))).finally(()=>v(!1)))};return React.createElement("div",{className:"max-w-4xl space-y-6 mt-8"},React.createElement("div",{className:"flex border-b border-slate-200"},React.createElement("button",{onClick:()=>{p("open"),e(1)},className:`px-6 py-3 text-sm font-bold transition-all border-b-2 ${r==="open"?"border-blue-600 text-blue-600":"border-transparent text-slate-500"}`},t("Active Tickets","tickefic")),React.createElement("button",{onClick:()=>{p("closed"),e(1)},className:`px-6 py-3 text-sm font-bold transition-all border-b-2 ${r==="closed"?"border-blue-600 text-blue-600":"border-transparent text-slate-500 hover:text-slate-700"}`},t("Closed","tickefic"))),React.createElement("div",{className:"space-y-4 relative min-h-[200px]"},o&&React.createElement("div",{className:"absolute inset-0 bg-white/60 z-10 flex items-center justify-center rounded-xl backdrop-blur-[1px]"},React.createElement("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})),n.length===0&&!o?React.createElement("div",{className:"text-center py-16 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200 text-slate-400"},t("No tickets found in this section.","tickefic")):n.map(a=>{const l=h===a.id,N=a.meta?.tickefic_priority||"normal";return React.createElement("div",{key:a.id,className:`bg-white border rounded-xl overflow-hidden transition-all duration-200 ${l?"border-slate-300 shadow-xl":"border-slate-200 shadow-sm"}`},React.createElement("div",{className:"p-5 cursor-pointer flex justify-between items-center group",onClick:()=>m(l?null:a.id)},React.createElement("div",{className:"flex items-center gap-4"},React.createElement("div",{className:`w-2 h-2 rounded-full ${N==="high"?"bg-red-500":N==="low"?"bg-slate-300":"bg-blue-500"}`}),React.createElement("div",null,React.createElement("h2",{className:"text-base font-bold text-slate-900 group-hover:text-blue-600"},E(a.title.rendered)),React.createElement("div",{className:"flex items-center gap-3 mt-1 text-xs text-slate-500 font-medium uppercase"},React.createElement("span",null,"#",a.id),React.createElement("span",null,"•"),React.createElement("span",null,new Date(a.date).toLocaleDateString())))),React.createElement("span",{className:"text-blue-600 text-xs font-black uppercase tracking-widest bg-blue-50 px-3 py-1.5 rounded-lg group-hover:bg-blue-600 group-hover:text-white"},l?t("Close","tickefic"):t("View Thread","tickefic"))),l&&React.createElement("div",{className:"p-6 border-t border-slate-100 bg-slate-50/30"},React.createElement("div",{className:"flex gap-4 mb-8"},React.createElement("div",{className:"w-10 h-10 rounded-full bg-slate-900 flex-shrink-0 flex items-center justify-center text-white font-bold"},a._embedded?.author?.[0]?.name?.charAt(0)||"U"),React.createElement("div",{className:"bg-white p-5 rounded-2xl border border-slate-200 text-sm text-slate-700 flex-1 shadow-sm"},React.createElement("div",{dangerouslySetInnerHTML:{__html:a.content.rendered}}))),React.createElement("div",{className:"space-y-6 mb-8"},c.map(R=>React.createElement("div",{key:R.id,className:`flex gap-4 ${R.author!==a.author?"flex-row-reverse text-right":""}`},React.createElement("div",{className:`w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center text-white font-bold ${R.author!==a.author?"bg-blue-600":"bg-slate-400"}`},R.author_name?.charAt(0)),React.createElement("div",{className:`p-5 rounded-2xl text-sm max-w-[85%] border ${R.author!==a.author?"bg-blue-50 border-blue-100":"bg-white border-slate-200"}`},React.createElement("div",{className:"font-bold mb-2"},R.author_name),React.createElement("div",{dangerouslySetInnerHTML:{__html:R.content.rendered}}))))),React.createElement("div",{className:"mt-8 pt-8 border-t border-slate-200"},React.createElement("textarea",{className:"w-full p-4 border border-slate-200 rounded-2xl text-sm outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-400",rows:"4",placeholder:t("Type your response here...","tickefic"),value:x,onChange:R=>g(R.target.value)}),React.createElement("div",{className:"mt-3 flex justify-end"},React.createElement("button",{onClick:()=>b(a.id),disabled:u||!x.trim(),className:"px-8 py-3 bg-slate-900 text-white text-xs font-black uppercase rounded-xl hover:bg-blue-600 transition-all"},u?t("Sending...","tickefic"):t("Post Reply","tickefic"))))))})),d>1&&React.createElement("div",{className:"flex items-center justify-center gap-2 pt-6 pb-10"},React.createElement("button",{disabled:i===1||o,onClick:()=>e(i-1),className:"p-4 rounded-xl bg-white border border-slate-200 hover:text-blue-600 disabled:opacity-40"},"←"),[...Array(d)].map((a,l)=>React.createElement("button",{key:l+1,onClick:()=>e(l+1),className:`py-2 px-4 text-sm font-bold rounded-xl transition-all ${i===l+1?"!bg-blue-600 !text-white shadow-lg shadow-blue-200":"!bg-white !text-slate-500 border border-slate-200"}`},l+1)),React.createElement("button",{disabled:i===d||o,onClick:()=>e(i+1),className:"p-4 rounded-xl bg-white border border-slate-200 hover:text-blue-600 disabled:opacity-40"},"→")))}const C=()=>{const[n,o]=s({username:"",password:""}),[i,d]=s(!1),[e,r]=s(""),p=m=>{const{name:c,value:f}=m.target;o(x=>({...x,[c]:f}))},h=async m=>{m.preventDefault(),d(!0);try{const c=await w({path:"http://localhost/devspark/wordpress-backend/wp-json/tickefic/v1/login",method:"POST",data:{username:n.username,password:n.password},credentials:"same-origin"});console.log(c),c.success&&window.location.reload()}catch(c){r(c.data.message),console.log(c)}finally{d(!1)}};return React.createElement("div",{className:"max-w-md mx-auto mt-10"},React.createElement("div",{className:"bg-white p-8 rounded-2xl shadow-xl border border-slate-100"},React.createElement("div",{className:"text-center mb-8"},React.createElement("h2",{className:"text-2xl font-bold text-slate-900"},t("Welcome Back","tickefic")),React.createElement("p",{className:"text-slate-500 text-sm mt-2"},t("Login to manage your support tickets","tickefic"))),React.createElement("form",{onSubmit:h,className:"space-y-5"},React.createElement("div",null,React.createElement("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2 tracking-wide"},t("Username / Email","tickefic")),React.createElement("input",{type:"text",name:"username",required:!0,value:n.username,onChange:p,className:"w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all outline-none text-sm",placeholder:"admin"})),React.createElement("div",null,React.createElement("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2 tracking-wide"},t("Password","tickefic")),React.createElement("input",{type:"password",name:"password",required:!0,value:n.password,onChange:p,className:"w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all outline-none text-sm",placeholder:"••••••••"})),e&&React.createElement("div",{className:"p-3 bg-red-50 text-red-600 text-xs rounded-lg border border-red-100"},e),React.createElement("button",{type:"submit",disabled:i,className:"w-full bg-slate-900 hover:bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg shadow-slate-200 transition-all active:scale-[0.98] disabled:bg-slate-400"},i?t("Signing in...","tickefic"):t("Sign In","tickefic")))))},L=({user:n,isLoading:o=!1})=>o?React.createElement("div",{className:"p-10 text-center animate-pulse text-slate-400"},t("Verifying session...","tickefic")):React.createElement("div",{className:"tickefic-user-container mb-4"},n?React.createElement("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200"},React.createElement("h2",{className:"text-xl font-bold"},t("Welcome,","tickefic")," ",n.name),React.createElement("p",{className:"text-slate-500 text-sm"},t("You are logged in and can manage tickets.","tickefic"))):React.createElement(C,null));function j(){const[n,o]=s([]),[i,d]=s(!0),[e,r]=s(null),[p,h]=s(!0),[m,c]=s(1),[f,x]=s(1),g=2,[u,v]=s("open");k(()=>{w({path:"http://localhost/devspark/wordpress-backend/wp-json/tickefic/v1/user-status",method:"GET",headers:{"X-WP-Nonce":window.SupportDashboard?.nonce}}).then(b=>{b.logged_in&&r(b.user)}).catch(b=>console.error("Auth check failed",b)).finally(()=>h(!1))},[]),k(()=>{e&&(d(!0),w({path:`http://localhost/devspark/wordpress-backend/wp-json/wp/v2/tickefic/?_embed&page=${m}&per_page=${g}&tickefic_status=${u}`,parse:!1,headers:{"X-WP-Nonce":window.SupportDashboard?.nonce}}).then(b=>(x(parseInt(b.headers.get("X-WP-TotalPages")||1)),b.json())).then(b=>{o(b),d(!1)}).catch(()=>d(!1)))},[e,m,u]);const E=b=>{if(m===1){const a={...b,_embedded:{author:[{name:e?.name}]}};o(l=>[a,...l.slice(0,g-1)])}else c(1)};return React.createElement("div",{className:"tickefic-dashboard"},React.createElement(L,{user:e,isLoading:p}),e&&React.createElement(React.Fragment,null,React.createElement(_,{onTicketCreated:E}),React.createElement(T,{tickets:n,loading:i,currentPage:m,totalPages:f,onPageChange:c,activeTab:u,setActiveTab:v})))}const S=document.getElementById("user-dashboard-root");S&&y&&y(S).render(React.createElement(j,null));
