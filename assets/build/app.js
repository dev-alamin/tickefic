(function(a,_,e){"use strict";const N=({onTicketCreated:l})=>{const[m,d]=a.useState(!1),[u,s]=a.useState(!1),[h,f]=a.useState(null),p={title:"",content:"",status:"publish",meta:{tickefic_priority:"normal",tickefic_status:"open"},tickefic_cat:[37]},[n,c]=a.useState(p),b=g=>{const{name:o,value:v}=g.target;if(o.startsWith("meta.")){const E=o.split(".")[1];c(i=>({...i,meta:{...i.meta,[E]:v}}))}else c(o==="tickefic_cat"?E=>({...E,[o]:[parseInt(v)]}):E=>({...E,[o]:v}))},x=async g=>{g.preventDefault(),s(!0),f(null);try{const o=await _({path:"/wp/v2/tickefic/",method:"POST",data:n,headers:{"X-WP-Nonce":SupportDashboard.nonce}});c(p),d(!1),l&&l(o)}catch(o){f(o.message||e.__("Failed to create ticket","tickefic"))}finally{s(!1)}};return React.createElement("div",{className:"max-w-2xl mb-8"},m?React.createElement("div",{className:"bg-white rounded-xl shadow-xl border border-slate-200 overflow-hidden"},React.createElement("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50"},React.createElement("h3",{className:"font-bold text-slate-800"},e.__("Create Ticket","tickefic")),React.createElement("button",{onClick:()=>d(!1),className:"text-slate-400 hover:text-red-500"},"✕")),React.createElement("form",{onSubmit:x,className:"p-6"},React.createElement("div",{className:"mb-4"},React.createElement("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1"},e.__("Subject","tickefic")),React.createElement("input",{type:"text",name:"title",value:n.title,onChange:b,required:!0,className:"w-full px-3 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500"})),React.createElement("div",{className:"grid grid-cols-2 gap-4 mb-4"},React.createElement("div",null,React.createElement("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1"},e.__("Priority","tickefic")),React.createElement("select",{name:"meta.tickefic_priority",value:n.meta.tickefic_priority,onChange:b,className:"w-full px-3 py-2 border rounded-lg outline-none"},React.createElement("option",{value:"low"},e.__("Low","tickefic")),React.createElement("option",{value:"normal"},e.__("Normal","tickefic")),React.createElement("option",{value:"high"},e.__("High","tickefic")))),React.createElement("div",null,React.createElement("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1"},e.__("Category","tickefic")),React.createElement("select",{name:"tickefic_cat",value:n.tickefic_cat[0],onChange:b,className:"w-full px-3 py-2 border rounded-lg outline-none"},React.createElement("option",{value:"38"},e.__("Technical Issue","tickefic")),React.createElement("option",{value:"37"},e.__("Billing / Account","tickefic")),React.createElement("option",{value:"39"},e.__("Feature Request","tickefic"))))),React.createElement("div",{className:"mb-6"},React.createElement("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-1"},e.__("Message","tickefic")),React.createElement("textarea",{name:"content",value:n.content,onChange:b,required:!0,rows:"4",className:"w-full px-3 py-2 border rounded-lg outline-none focus:ring-2 focus:ring-blue-500"})),h&&React.createElement("div",{className:"mb-4 p-3 bg-red-50 text-red-600 text-xs rounded border border-red-100"},h),React.createElement("button",{type:"submit",disabled:u,className:"w-full bg-slate-900 hover:bg-blue-600 disabled:bg-slate-400 text-white font-bold py-2.5 rounded-lg transition-colors"},u?e.__("Sending...","tickefic"):e.__("Submit Ticket","tickefic")))):React.createElement("button",{onClick:()=>d(!0),className:"w-[300px] py-2 rounded-xl flex items-center justify-center gap-2 text-slate-600 border border-slate-200 hover:border-blue-400 hover:bg-blue-50 transition-all group"},React.createElement("span",{className:"text-xl group-hover:rotate-90 transition-transform"},"＋"),React.createElement("span",{className:"font-semibold"},e.__("Open a New Support Ticket","tickefic"))))};function y({tickets:l,loading:m,currentPage:d,totalPages:u,onPageChange:s,activeTab:h,setActiveTab:f}){const[p,n]=a.useState(null),[c,b]=a.useState([]),[x,g]=a.useState(""),[o,v]=a.useState(!1),E=t=>{const r=document.createElement("textarea");return r.innerHTML=t,r.value.replace(/<[^>]*>/g,"")};a.useEffect(()=>{p&&(b([]),_({path:`/wp/v2/comments?post=${p}&order=asc&_embed`}).then(t=>b(t)).catch(t=>console.error("Error fetching replies:",t)))},[p]);const i=t=>{x.trim()&&(v(!0),_({path:"/wp/v2/comments",method:"POST",data:{post:t,content:x,status:"approve"},headers:{"X-WP-Nonce":window.SupportDashboard?.nonce}}).then(r=>{b([...c,r]),g("")}).catch(r=>alert(r.message||e.__("Failed to send reply.","tickefic"))).finally(()=>v(!1)))};return React.createElement("div",{className:"max-w-4xl space-y-6 mt-8"},React.createElement("div",{className:"flex border-b border-slate-200"},React.createElement("button",{onClick:()=>{f("open"),s(1)},className:`px-6 py-3 text-sm font-bold transition-all border-b-2 ${h==="open"?"border-blue-600 text-blue-600":"border-transparent text-slate-500"}`},e.__("Active Tickets","tickefic")),React.createElement("button",{onClick:()=>{f("closed"),s(1)},className:`px-6 py-3 text-sm font-bold transition-all border-b-2 ${h==="closed"?"border-blue-600 text-blue-600":"border-transparent text-slate-500 hover:text-slate-700"}`},e.__("Closed","tickefic"))),React.createElement("div",{className:"space-y-4 relative min-h-[200px]"},m&&React.createElement("div",{className:"absolute inset-0 bg-white/60 z-10 flex items-center justify-center rounded-xl backdrop-blur-[1px]"},React.createElement("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})),l.length===0&&!m?React.createElement("div",{className:"text-center py-16 bg-slate-50 rounded-xl border-2 border-dashed border-slate-200 text-slate-400"},e.__("No tickets found in this section.","tickefic")):l.map(t=>{const r=p===t.id,k=t.meta?.tickefic_priority||"normal";return React.createElement("div",{key:t.id,className:`bg-white border rounded-xl overflow-hidden transition-all duration-200 ${r?"border-slate-300 shadow-xl":"border-slate-200 shadow-sm"}`},React.createElement("div",{className:"p-5 cursor-pointer flex justify-between items-center group",onClick:()=>n(r?null:t.id)},React.createElement("div",{className:"flex items-center gap-4"},React.createElement("div",{className:`w-2 h-2 rounded-full ${k==="high"?"bg-red-500":k==="low"?"bg-slate-300":"bg-blue-500"}`}),React.createElement("div",null,React.createElement("h2",{className:"text-base font-bold text-slate-900 group-hover:text-blue-600"},E(t.title.rendered)),React.createElement("div",{className:"flex items-center gap-3 mt-1 text-xs text-slate-500 font-medium uppercase"},React.createElement("span",null,"#",t.id),React.createElement("span",null,"•"),React.createElement("span",null,new Date(t.date).toLocaleDateString())))),React.createElement("span",{className:"text-blue-600 text-xs font-black uppercase tracking-widest bg-blue-50 px-3 py-1.5 rounded-lg group-hover:bg-blue-600 group-hover:text-white"},r?e.__("Close","tickefic"):e.__("View Thread","tickefic"))),r&&React.createElement("div",{className:"p-6 border-t border-slate-100 bg-slate-50/30"},React.createElement("div",{className:"flex gap-4 mb-8"},React.createElement("div",{className:"w-10 h-10 rounded-full bg-slate-900 flex-shrink-0 flex items-center justify-center text-white font-bold"},t._embedded?.author?.[0]?.name?.charAt(0)||"U"),React.createElement("div",{className:"bg-white p-5 rounded-2xl border border-slate-200 text-sm text-slate-700 flex-1 shadow-sm"},React.createElement("div",{dangerouslySetInnerHTML:{__html:t.content.rendered}}))),React.createElement("div",{className:"space-y-6 mb-8"},c.map(R=>React.createElement("div",{key:R.id,className:`flex gap-4 ${R.author!==t.author?"flex-row-reverse text-right":""}`},React.createElement("div",{className:`w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center text-white font-bold ${R.author!==t.author?"bg-blue-600":"bg-slate-400"}`},R.author_name?.charAt(0)),React.createElement("div",{className:`p-5 rounded-2xl text-sm max-w-[85%] border ${R.author!==t.author?"bg-blue-50 border-blue-100":"bg-white border-slate-200"}`},React.createElement("div",{className:"font-bold mb-2"},R.author_name),React.createElement("div",{dangerouslySetInnerHTML:{__html:R.content.rendered}}))))),React.createElement("div",{className:"mt-8 pt-8 border-t border-slate-200"},React.createElement("textarea",{className:"w-full p-4 border border-slate-200 rounded-2xl text-sm outline-none focus:ring-4 focus:ring-blue-100 focus:border-blue-400",rows:"4",placeholder:e.__("Type your response here...","tickefic"),value:x,onChange:R=>g(R.target.value)}),React.createElement("div",{className:"mt-3 flex justify-end"},React.createElement("button",{onClick:()=>i(t.id),disabled:o||!x.trim(),className:"px-8 py-3 bg-slate-900 text-white text-xs font-black uppercase rounded-xl hover:bg-blue-600 transition-all"},o?e.__("Sending...","tickefic"):e.__("Post Reply","tickefic"))))))})),u>1&&React.createElement("div",{className:"flex items-center justify-center gap-2 pt-6 pb-10"},React.createElement("button",{disabled:d===1||m,onClick:()=>s(d-1),className:"p-4 rounded-xl bg-white border border-slate-200 hover:text-blue-600 disabled:opacity-40"},"←"),[...Array(u)].map((t,r)=>React.createElement("button",{key:r+1,onClick:()=>s(r+1),className:`py-2 px-4 text-sm font-bold rounded-xl transition-all ${d===r+1?"!bg-blue-600 !text-white shadow-lg shadow-blue-200":"!bg-white !text-slate-500 border border-slate-200"}`},r+1)),React.createElement("button",{disabled:d===u||m,onClick:()=>s(d+1),className:"p-4 rounded-xl bg-white border border-slate-200 hover:text-blue-600 disabled:opacity-40"},"→")))}const S=()=>{const[l,m]=a.useState({username:"",password:""}),[d,u]=a.useState(!1),[s,h]=a.useState(""),f=n=>{const{name:c,value:b}=n.target;m(x=>({...x,[c]:b}))},p=async n=>{n.preventDefault(),u(!0);try{const c=await _({path:"/tickefic/v1/login",method:"POST",data:{username:l.username,password:l.password},credentials:"same-origin"});console.log(c),c.success&&window.location.reload()}catch(c){h(c.data.message),console.log(c)}finally{u(!1)}};return React.createElement("div",{className:"max-w-md mx-auto mt-10"},React.createElement("div",{className:"bg-white p-8 rounded-2xl shadow-xl border border-slate-100"},React.createElement("div",{className:"text-center mb-8"},React.createElement("h2",{className:"text-2xl font-bold text-slate-900"},e.__("Welcome Back","tickefic")),React.createElement("p",{className:"text-slate-500 text-sm mt-2"},e.__("Login to manage your support tickets","tickefic"))),React.createElement("form",{onSubmit:p,className:"space-y-5"},React.createElement("div",null,React.createElement("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2 tracking-wide"},e.__("Username / Email","tickefic")),React.createElement("input",{type:"text",name:"username",required:!0,value:l.username,onChange:f,className:"w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all outline-none text-sm",placeholder:"admin"})),React.createElement("div",null,React.createElement("label",{className:"block text-xs font-bold uppercase text-slate-500 mb-2 tracking-wide"},e.__("Password","tickefic")),React.createElement("input",{type:"password",name:"password",required:!0,value:l.password,onChange:f,className:"w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all outline-none text-sm",placeholder:"••••••••"})),s&&React.createElement("div",{className:"p-3 bg-red-50 text-red-600 text-xs rounded-lg border border-red-100"},s),React.createElement("button",{type:"submit",disabled:d,className:"w-full bg-slate-900 hover:bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg shadow-slate-200 transition-all active:scale-[0.98] disabled:bg-slate-400"},d?e.__("Signing in...","tickefic"):e.__("Sign In","tickefic")))))},T=({user:l,isLoading:m=!1})=>m?React.createElement("div",{className:"p-10 text-center animate-pulse text-slate-400"},e.__("Verifying session...","tickefic")):React.createElement("div",{className:"tickefic-user-container mb-4"},l?React.createElement("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200"},React.createElement("h2",{className:"text-xl font-bold"},e.__("Welcome,","tickefic")," ",l.name),React.createElement("p",{className:"text-slate-500 text-sm"},e.__("You are logged in and can manage tickets.","tickefic"))):React.createElement(S,null));function C(){const[l,m]=a.useState([]),[d,u]=a.useState(!0),[s,h]=a.useState(null),[f,p]=a.useState(!0),[n,c]=a.useState(1),[b,x]=a.useState(1),g=2,[o,v]=a.useState("open");a.useEffect(()=>{_({path:"/tickefic/v1/user-status",method:"GET",headers:{"X-WP-Nonce":window.SupportDashboard?.nonce}}).then(i=>{i.logged_in&&h(i.user)}).catch(i=>console.error("Auth check failed",i)).finally(()=>p(!1))},[]),a.useEffect(()=>{s&&(u(!0),_({path:`/wp/v2/tickefic/?_embed&page=${n}&per_page=${g}&tickefic_status=${o}`,parse:!1,headers:{"X-WP-Nonce":window.SupportDashboard?.nonce}}).then(i=>(x(parseInt(i.headers.get("X-WP-TotalPages")||1)),i.json())).then(i=>{m(i),u(!1)}).catch(()=>u(!1)))},[s,n,o]);const E=i=>{if(n===1){const t={...i,_embedded:{author:[{name:s?.name}]}};m(r=>[t,...r.slice(0,g-1)])}else c(1)};return React.createElement("div",{className:"tickefic-dashboard"},React.createElement(T,{user:s,isLoading:f}),s&&React.createElement(React.Fragment,null,React.createElement(N,{onTicketCreated:E}),React.createElement(y,{tickets:l,loading:d,currentPage:n,totalPages:b,onPageChange:c,activeTab:o,setActiveTab:v})))}const w=document.getElementById("user-dashboard-root");w&&a.createRoot&&a.createRoot(w).render(React.createElement(C,null))})(wp.element,wp.apiFetch,wp.i18n);
